/*--------------------------------------------------------------*/
/*                                                              */ 
/*		update_grass_mowing									*/
/*                                                              */
/*  NAME                                                        */
/*		update_grass_mowing									*/
/*                                                              */
/*                                                              */
/*  SYNOPSIS                                                    */
/* 	void update_grass_mowing( 
/*                      struct epconst_struct,			*/
/*                      struct phenology_struct *,		*/
/*                      struct cstate_struct *,			*/
/*                      struct cdayflux_struct *,		*/
/*                      struct cdayflux_patch_struct *,		*/
/*                      struct nstate_struct *,			*/
/*                      struct ndayflux_struct *,		*/
/*                      struct ndayflux_patch_struct *,		*/
/*                      struct litter_c_object *,		*/
/*                      struct litter_n_object *,		*/
/*                      double,int);				*/
/*								*/
/*  OPTIONS                                                     */
/*                                                              */
/*  DESCRIPTION                                                 */
/*                                                              */
/*                                                              */
/*	calculated daily grass_mowing losses and updates 		*/
/*	carbon and nitrogen pools				*/
/*	it is either removed or goes to litter depending on	*/
/*	user specification					*/
/*                                                              */
/*  PROGRAMMER NOTES                                            */
/*                                                              */
/*	from P.Thornton (1997) version of 1d_bgc		*/
/*                                                              */
/*                                                              */
/*--------------------------------------------------------------*/

#include <stdio.h>
#include "rhessys.h"
#include "phys_constants.h"
void update_grass_mowing(
					  struct epconst_struct	epc	,
					  struct cstate_struct *cs,
					  struct cdayflux_struct	*cdf,
					  struct cdayflux_patch_struct *cdf_patch,
					  struct nstate_struct *ns,
					  struct ndayflux_struct	*ndf,
					  struct ndayflux_patch_struct *ndf_patch,
					  struct litter_c_object *cs_litr,
					  struct litter_n_object *ns_litr,
					  double	cover_fraction,
					  int		 grass_removal_flag)
{
	/*------------------------------------------------------*/
	/*	Local Function Declarations.						*/
	/*------------------------------------------------------*/
	
	/*------------------------------------------------------*/
	/*	Local Variable Definition. 							*/
	/*------------------------------------------------------*/
	double mort, new_leafc;
	double m_leafc_to_litr1c, m_leafc_to_litr2c;
	double m_leafc_to_litr3c, m_leafc_to_litr4c;


	/*------------------------------------------------------*/
	/*	determine how much carbon to remove		*/
	/*	for GRASSES we will assume that new LAI is all sunlit */
	/*------------------------------------------------------*/
	new_leafc = epv->lai_cut / epv->sla_sunlit
	mort = 1.0 - new_leafc / cs->leafc;
	/*------------------------------------------------------*/
	/*	send cut grass to litter pools			*/
	/*	this could be changed so that grass is actually	*/
	/*	removed						*/
	/*------------------------------------------------------*/

	if (grass_removal_flag == 0) {
	m_leafc_to_litr1c = mort * cs->leafc * epc.leaflitr_flab;
	m_leafc_to_litr2c = mort * cs->leafc * epc.leaflitr_fucel;
	m_leafc_to_litr3c = mort * cs->leafc * epc.leaflitr_fscel;
	m_leafc_to_litr4c = mort * cs->leafc * epc.leaflitr_flig;
	cdf_patch->m_leafc_to_litr1c += m_leafc_to_litr1c * cover_fraction;
	cdf_patch->m_leafc_to_litr2c += m_leafc_to_litr2c * cover_fraction;
	cdf_patch->m_leafc_to_litr3c += m_leafc_to_litr3c * cover_fraction;
	cdf_patch->m_leafc_to_litr4c += m_leafc_to_litr4c * cover_fraction;
	/*------------------------------------------------------*/
	/* daily nitrogen fluxes due to grass_mowing */
	/*------------------------------------------------------*/

	m_leafn_to_litr1n = m_leafc_to_litr1c / epc.leaf_cn;
	m_leafn_to_litr2n = m_leafc_to_litr2c / epc.leaf_cn;
	m_leafn_to_litr3n = m_leafc_to_litr3c / epc.leaf_cn;
	m_leafn_to_litr4n = m_leafc_to_litr4c / epc.leaf_cn;
	ndf_patch->m_leafn_to_litr1n += m_leafn_to_litr1n * cover_fraction;
	ndf_patch->m_leafn_to_litr2n += m_leafn_to_litr2n * cover_fraction;
	ndf_patch->m_leafn_to_litr3n += m_leafn_to_litr3n * cover_fraction;
	ndf_patch->m_leafn_to_litr4n += m_leafn_to_litr4n * cover_fraction;

	/*------------------------------------------------------*/
	/* update state variables */
	/* CARBON grass_mowing state variable update */
	/*------------------------------------------------------*/
	cs_litr->litr1c    += m_leafc_to_litr1c * cover_fraction;
	cs->leafc          -= m_leafc_to_litr1c;
	cs_litr->litr2c    += m_leafc_to_litr2c * cover_fraction;
	cs->leafc          -= m_leafc_to_litr2c;
	cs_litr->litr3c    += m_leafc_to_litr3c * cover_fraction;
	cs->leafc          -= m_leafc_to_litr3c;
	cs_litr->litr4c    += m_leafc_to_litr4c * cover_fraction;
	cs->leafc          -= m_leafc_to_litr4c;

	/*------------------------------------------------------*/
	/* NITROGEN grass_mowing state variable update */
	/*------------------------------------------------------*/
	ns_litr->litr1n    += m_leafn_to_litr1n * cover_fraction;
	ns->leafn          -= m_leafn_to_litr1n;
	ns_litr->litr2n    += m_leafn_to_litr2n * cover_fraction;
	ns->leafn          -= m_leafn_to_litr2n;
	ns_litr->litr3n    += m_leafn_to_litr3n * cover_fraction;
	ns->leafn          -= m_leafn_to_litr3n;
	ns_litr->litr4n    += m_leafn_to_litr4n * cover_fraction;
	ns->leafn          -= m_leafn_to_litr4n;
	}

	else {
	/*------------------------------------------------------*/
	/*	remove grass from watershed			*/
	/*------------------------------------------------------*/
	cs->leafc          -= mort * cs->leafc;
	ns->leafn          -= mort * ns->leafn;
	}
	return;
}/*end update_grass_mowing*/

